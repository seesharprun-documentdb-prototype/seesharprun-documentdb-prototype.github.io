type: operator
category: accumulator
name: $median
description: |-
  The `$median` accumulator operator calculates the median value of a numeric field in a group of documents. It's useful for finding the middle value in a distribution of data.
syntax: |-
  {
    $group: {
      _id: <expression>,
      medianValue: {
        $median: {
          input: <field or expression>,
          method: <>
        }
      }
    }
  }
parameters:
  - name: input
    type: object
    required: true
    description: |-
      The field or expression from which to calculate the median.
  - name: method
    type: string
    required: true
    description: |-
      The method to use for calculating the median. Typically "approximate".
examples:
  sample: |-
    {
      "_id": "0fcc0bf0-ed18-4ab8-b558-9848e18058f4",
      "name": "First Up Consultants | Beverage Shop",
      "sales": {
        "totalSales": 75670,
        "salesByCategory": [
          { "categoryName": "Wine Accessories", "totalSales": 34440 },
          { "categoryName": "Bitters", "totalSales": 39496 },
          { "categoryName": "Rum", "totalSales": 1734 }
        ]
      }
    }
  items:
    - title: Calculate the median sales volume
      explanation: |-
        Calculate the median sales volume within each category across all stores.
      description: |-
        This query groups documents by distinct sales categories and calculates the median sales within each category.
      query: |-
        db.stores.aggregate([
          { $unwind: "$sales.salesByCategory" },
          {
            $group: {
              _id: "$sales.salesByCategory.categoryName",
              medianSales: {
                $median: {
                  input: "$sales.salesByCategory.totalSales",
                  method: "approximate"
                }
              }
            }
          }
        ])
      output:
        value: |-
          [
            { "_id": "Light Bulbs", "medianSales": 24845 },
            { "_id": "Christmas Trees", "medianSales": 28210 },
            { "_id": "Ukuleles", "medianSales": 27295 },
            { "_id": "GPUs", "medianSales": 19813 },
            { "_id": "Towels", "medianSales": 27771 }
          ]
related:
  - reference: /operator/accumulator/avg
  - reference: /operator/accumulator/percentile
