type: operator
category: window
name: $locf
description: Propagates the last observed non-null value forward within a partition, useful for filling missing data points in time-series datasets.
syntax: '{ $locf: { input: <expression>, sortBy: <document> } }'
parameters:
  - name: input
    type: object
    required: true
    description: Expression that resolves to the field whose value to propagate
  - name: sortBy
    type: object
    required: true
    description: Document specifying the sort order for the partition
examples:
  items:
    - title: Fill missing time series data
      description: Propagate last non-null value for missing data within company partition
      query: 'db.stores.aggregate([{ $match: { "company": { $in: ["First Up Consultants"] } } }, { $setWindowFields: { "partitionBy": "$name", "sortBy": { "sales.revenue": 1 }, "output": { "lastUpdatedDate": { "$locf": { "lastUpdated": 1 } } } } }])'
      output:
        value: Stores with missing lastUpdated values filled with last observed non-null value
    - title: Forward fill sensor readings
      description: Use last observed value to fill gaps in sensor data
      query: 'db.sensors.aggregate([{ $setWindowFields: { "partitionBy": "$sensorId", "sortBy": { "timestamp": 1 }, "output": { "filledReading": { "$locf": { input: "$reading", sortBy: { "timestamp": 1 } } } } } }])'
      output:
        value: Sensor data with missing readings filled using last observed values
related:
  - reference: /reference/operator/linearfill