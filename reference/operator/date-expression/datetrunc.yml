type: operator
category: date-expression
name: $dateTrunc
description: Expression operator truncates a date to the nearest specified unit (for example, hour, day, month). It's useful when working with time-series data or when grouping data by specific time intervals. This operator can be used to simplify and standardize date calculations.
syntax: "$dateTrunc: { date: <dateExpression>, unit: <unit>, binSize: <number>, timezone: <timezone>, startOfWeek: <day> }"
parameters:
  - name: date
    type: object
    required: true
    description: The date to truncate.
  - name: unit
    type: string
    required: true
    description: The unit to truncate the date to. Supported values include year, month, week, day, hour, minute, second, and millisecond.
  - name: binSize
    type: number
    required: false
    description: Optional. The size of each bin for truncation. For example, if binSize is 2 and unit is hour, the date is truncated to every 2 hours.
  - name: timezone
    type: string
    required: false
    description: Optional. The timezone to use for truncation. Defaults to UTC if not specified.
  - name: startOfWeek
    type: string
    required: false
    description: Optional. Used when unit is "week".
examples:
  items:
    - title: Truncate to the day
      description: This query uses $dateTrunc to truncate the lastUpdated timestamp to the start of the day (00:00:00) in UTC. The operator is useful for grouping or comparing data by calendar day regardless of time.
      query: |
        db.stores.aggregate([
          {
            $match: { _id: "e6410bb3-843d-4fa6-8c70-7472925f6d0a" }
          },
          {
            $project: {
              _id: 0,
              truncatedToDay: {
                $dateTrunc: {
                  date: "$lastUpdated",
                  unit: "day"
                }
              }
            }
          }
        ])
      output:
        value: |
          [
            {
              "truncatedToDay": "2024-11-29T00:00:00.000Z"
            }
          ]
    - title: Truncate to the start of the week
      description: This query uses $dateTrunc to round the lastUpdated timestamp down to the start of its week. It specifies Monday as the start of the week to ensure consistent calendar alignment.
      query: |
        db.stores.aggregate([
          {
            $match: { _id: "e6410bb3-843d-4fa6-8c70-7472925f6d0a" }
          },
          {
            $project: {
              _id: 0,
              truncatedToWeek: {
                $dateTrunc: {
                  date: "$lastUpdated",
                  unit: "week",
                  startOfWeek: "Monday"
                }
              }
            }
          }
        ])
      output:
        value: |
          [
            {
              "truncatedToWeek": "2024-11-25T00:00:00.000Z"
            }
          ]
related:
  - reference: $dateAdd
  - reference: $dateDiff
  - reference: $dateToString