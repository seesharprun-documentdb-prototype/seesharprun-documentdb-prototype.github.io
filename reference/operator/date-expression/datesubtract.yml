type: operator
category: date-expression
name: $dateSubtract
description: Subtracts a specified time unit from a date. It's useful for calculating past dates or intervals in aggregation pipelines.
syntax: "$dateSubtract: { startDate: <dateExpression>, unit: <unit>, amount: <number>, timezone: <timezone> }"
parameters:
  - name: startDate
    type: object
    required: true
    description: The date expression to subtract from.
  - name: unit
    type: string
    required: true
    description: The time unit to subtract (for example, "day", "hour").
  - name: amount
    type: number
    required: true
    description: The amount of the time unit to subtract.
  - name: timezone
    type: string
    required: false
    description: Optional. Timezone for date calculation.
examples:
  items:
    - title: Subtract seven days
      description: This query calculates the date one week before the lastUpdated field. This query uses $dateSubtract to calculate the date exactly seven days before the storeOpeningDate timestamp.
      query: |
        db.stores.aggregate([
          {
            $match: { _id: "e6410bb3-843d-4fa6-8c70-7472925f6d0a" }
          },
          {
            $project: {
              _id: 0,
              dateOneWeekAgo: {
                $dateSubtract: {
                  startDate: "$storeOpeningDate",
                  unit: "day",
                  amount: 7
                }
              }
            }
          }
        ])
      output:
        value: |
          [
            {
              "dateOneWeekAgo": "2024-08-29T11:50:06.549Z"
            }
          ]
related:
  - reference: $dateAdd
  - reference: $dateDiff
  - reference: $dateFromParts
